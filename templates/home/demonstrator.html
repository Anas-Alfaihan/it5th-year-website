{% extends "base.html" %} {% block head_title %} {{demonstrator.name}}
{%endblock %} {% load static %} {% block style %}
<link rel="stylesheet" href="{% static 'css/demonstrator.css' %}" />
<link rel="stylesheet" href="{% static 'css/date-picker.min.css' %}" />

{% endblock %}

<!-- something here for nothing  -->

{% load static %} {% block content %}
<h2 class="tit">{{demonstrator.name}}</h2>
<section class="sec">
    <class class="container">
        <div id="nav">
            <ul>
                <li class="aactive first">
                    <button type="button">المعلومات الشخصية</button>
                </li>
                <li class="second">
                    <button type="button">معلومات الاتصال</button>
                </li>
                <li class="third">
                    <button type="button">الحالة الاجتماعية</button>
                </li>
                <li class="forth">
                    <button type="button">الشهادة الجامعية</button>
                </li>
                <li class="fifth">
                    <button type="button">الإيفادات</button>
                </li>
            </ul>
        </div>
    </class>
    <div class="container" id="content">
        <div class="first">
            <div class="grd">
                <div class="gr-1">
                    <p class="ct">
                        <span> اسم الأب:</span>
                    </p>
                    <p class="ct">
                        <span> اسم الأم:</span>
                    </p>
                    <p class="ct">
                        <span> الجنس:</span>
                    </p>
                    <p class="ct">
                        <span> تاريخ الميلاد:</span>
                    </p>
                </div>
                <div class="gr-2">
                    <p class="ct">{{demonstrator.fatherName}}</p>
                    <p class="ct">{{demonstrator.motherName}}</p>
                    <p class="ct">{{demonstrator.get_gender_display}}</p>
                    <p class="ct">
                        {{demonstrator.birthDate|date:"SHORT_DATE_FORMAT"}}
                    </p>
                </div>
            </div>
        </div>
        <div class="second" style="display: none">
            <div class="grd">
                <div class="gr-1">
                    <p class="ct"><span> الإيميل:</span></p>
                    <p class="ct"><span> مكان الإقامة:</span></p>
                    <p class="ct">
                        <span> العنوان الحالي:</span>
                    </p>
                    <p class="ct">
                        <span> الهاتف المحمول:</span>
                    </p>
                    <p class="ct">
                        <span> رقم الهاتف الأرضي:</span>
                    </p>
                </div>
                <div class="gr-2">
                    <p class="ct">{{demonstrator.email}}</p>
                    <p class="ct">{{demonstrator.home}}</p>
                    <p class="ct">{{demonstrator.residence}}</p>
                    <p class="ct">{{demonstrator.mobile}}</p>
                    <p class="ct">{{demonstrator.telephone}}</p>
                </div>
            </div>
        </div>
        <div class="third" style="display: none">
            <div class="grd">
                <div class="gr-1">
                    <p class="ct">
                        <span> الحالة العائلية:</span>
                    </p>
                    <p class="ct">
                        <span> الوضع العسكري:</span>
                    </p>
                </div>
                <div class="gr-2">
                    <p class="ct">{{demonstrator.get_maritalStatus_display}}</p>
                    <p class="ct">
                        {{demonstrator.get_militarySituation_display}}
                    </p>
                </div>
            </div>
        </div>
        <div class="forth" style="display: none">
            <div class="grd">
                <div class="gr-1">
                    <p class="ct">
                        <span> الكلية:</span>
                    </p>
                    <p class="ct">
                        <span> الجامعة:</span>
                    </p>
                    <p class="ct">
                        <span> القسم:</span>
                    </p>
                    <p class="ct">
                        <span> السنة:</span>
                    </p>
                    <p class="ct">
                        <span> المعدل:</span>
                    </p>
                </div>
                <div class="gr-2">
                    <p class="ct">
                        {{demonstrator.universityDegree.universityDegreeCollege}}
                    </p>
                    <p class="ct">
                        {{demonstrator.universityDegree.universityDegreeUniversity}}
                    </p>
                    <p class="ct">
                        {{demonstrator.universityDegree.universityDegreeSection}}
                    </p>
                    <p class="ct">
                        {{demonstrator.universityDegree.universityDegreeYear}}
                    </p>
                    <p class="ct">
                        {{demonstrator.universityDegree.universityDegreeAverage}}
                    </p>
                </div>
            </div>
        </div>
        <div class="fifth" style="display: none">
            <div class="row justify-content-center mx-auto">
                <div class="accordion" id="efads">
                    {% for i in demonstrator.dispatch.all %}
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="efad-{{i.id}}">
                            <button class="accordion-button collapsed ct" type="button" data-bs-toggle="collapse"
                                data-bs-target="#info-{{i.id}}" aria-expanded="false" aria-controls="info-{{i.id}}">
                                <span>شهادة الإيفاد:</span>{{i.get_requiredCertificate_display}}
                            </button>
                        </h2>
                        <div class="accordion-collapse collapse" id="info-{{i.id}}" aria-labelledby="efad-{{i.id}}"
                            data-bs-parent="#efads">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-12 row g-0 ct">
                                        <div class="text-lead text-muted fs-6 col-2 mb-4">
                                            رقم القرار
                                            /<span class="efad-info-{{i.id}} editable"
                                                name="dispatchDecisionNumber">{{i.dispatchDecisionNumber}}</span>/<span
                                                class=" efad-info-{{i.id}} editable mul" name="dispatchDecisionType"
                                                value="{{i.dispatchDecisionType}}">{{i.get_dispatchDecisionType_display}}
                                            </span>
                                            <div class="d-none choises dispatchDecisionType">
                                                <div><strong value="s">ش.ع</strong></div>
                                                <div><strong value="o">و</strong></div>
                                                <div><strong value="b">ب</strong></div>
                                            </div>
                                        </div>
                                        <p class="text-lead text-muted fs-6 col-2">
                                            تاريخ

                                            <span class="efad-info-{{i.id}} editable" name="dispatchDecisionDate"
                                                data-toggle="datepicker">{{i.dispatchDecisionDate|date:"SHORT_DATE_FORMAT"}}</span>
                                        </p>
                                    </div>
                                </div>

                                <div class="row">

                                    <div class="ct col-6 mb-4">
                                        <span>نوع الإيفاد:</span><span class="efad-info-{{i.id}} editable mul"
                                            name="dispatchType"
                                            value="{{i.dispatchType}}">{{i.get_dispatchType_display}}</span>
                                        <div class="d-none choises dispatchType">
                                            <div>
                                                <strong value="inner">داخلي</strong>
                                            </div>
                                            <div><strong value="outer">خارجي</strong></div>
                                        </div>
                                    </div>
                                    <div class="ct col-6 mb-4">
                                        <span>النفقة:</span><span class="efad-info-{{i.id}} editable mul" name="alimony"
                                            value="{{i.alimony}}">
                                            {{i.get_alimony_display|default:""}}
                                        </span>
                                        <div class="d-none choises alimony">
                                            <div>
                                                <strong value="grant">منحة</strong>
                                            </div>
                                            <div><strong value="seat">مقعد</strong></div>
                                        </div>
                                    </div>
                                    <p class="ct col-6">
                                        <span>بلد الإيفاد:</span><span class="efad-info-{{i.id}} editable"
                                            name="dispatchCountry">{{i.dispatchCountry}}</span>
                                    </p>
                                    <p class="ct col-6">
                                        <span>جامعة الإيفاد:</span><span class="efad-info-{{i.id}} editable"
                                            name="dispatchUniversity">{{i.dispatchUniversity}}</span>
                                    </p>
                                    <p class="ct col-6">
                                        <span>المشرف الداخلي:</span><span class="efad-info-{{i.id}} editable"
                                            name="innerSupervisor">{{i.innerSupervisor}}</span>
                                    </p>
                                    <p class="ct col-6">
                                        <span>المشرف الخارجي:</span><span class="efad-info-{{i.id}} editable"
                                            name="outerSupervisor">{{i.outerSupervisor}}</span>
                                    </p>
                                    <p class="ct col-6">
                                        <span>تاريخ العودة:</span><span data-toggle="datepicker"
                                            class="efad-info-{{i.id}} editable"
                                            name="backDate">{{i.backDate|default:""}}</span>
                                    </p>
                                </div>

                                <p class="ct">
                                    <span>تاريخ آخر تقرير:</span><span class="efad-info-{{i.id}} editable"
                                        data-toggle="datepicker" name="lastReportDate">{{i.lastReportDate}}</span>
                                </p>
                                <div class="row">
                                    <div class="col-6">
                                        {% for ex in i.extension.all %}
                                        <div class="card border-info mb-3">
                                            <div class="card-header">

                                                <div class="text-lead text-muted fs-6 d-inline-block"
                                                    style="margin-left: 20px;">
                                                    رقم القرار
                                                    /<span class="ex-{{ex.id}} editable"
                                                        name="extensionDecisionNumber">{{ex.extensionDecisionNumber}}</span>/<span
                                                        class="ex-{{ex.id}} editable" name="extensionDecisionType"
                                                        name="extensionDecisionType"
                                                        value="{{ex.extensionDecisionType}}">{{ex.get_extensionDecisionType_display}}</span>
                                                    <div class="d-none choises extensionDecisionType">
                                                        <div><strong value="s">ش.ع</strong></div>
                                                        <div><strong value="o">و</strong></div>
                                                        <div><strong value="b">ب</strong></div>
                                                    </div>
                                                </div>
                                                <div class="text-lead text-muted fs-6 d-inline-block">
                                                    تاريخ
                                                    <span class="ex-{{ex.id}} editable" name="extensionDecisionDate"
                                                        data-toggle="datepicker">{{ex.extensionDecisionDate|date:"SHORT_DATE_FORMAT"}}</span>
                                                </div>

                                            </div>
                                            <div class="card-body">
                                                <div class="row align-items-center justify-content-between mb-2">
                                                    <div class="col-4 pt-3">
                                                        <p class="fs-5">مدة التمديد</p>
                                                    </div>
                                                    <div class="col-4 text-end"><button type="button"
                                                            class="btn btn-sm btn-outline-success"
                                                            onclick="editEx(event,'{{ex.id}}', '{{demonstrator.id}}')"
                                                            id="exeb-{{ex.id}}">تعديل</button></div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-4">
                                                        <p class="ct"><span>سنة:</span><span
                                                                class="ex-{{ex.id}} editable"
                                                                name="extensionDurationYear">{{ex.extensionDurationYear|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-4">
                                                        <p class="ct"><span>شهر:</span><span
                                                                class="ex-{{ex.id}} editable"
                                                                name="extensionDurationMonth">{{ex.extensionDurationMonth|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-4">
                                                        <p class="ct"><span>يوم:</span><span
                                                                class="ex-{{ex.id}} editable"
                                                                name="extensionDurationDay">{{ex.extensionDurationDay|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                </div>



                                            </div>

                                        </div>
                                        {% endfor %}
                                    </div>
                                    <div class="col-6">

                                        {% for fr in i.freeze.all %}
                                        <div class="card border-warning mb-3">
                                            <div class="card-header">

                                                <div class="text-lead text-muted fs-6 d-inline-block"
                                                    style="margin-left: 20px;">
                                                    رقم القرار
                                                    /<span class="fr-{{fr.id}} editable"
                                                        name="freezeDecisionNumber">{{fr.freezeDecisionNumber}}</span>/<span
                                                        class="fr-{{fr.id}} editable mul" name="freezeDecisionType"
                                                        value="{{fr.freezeDecisionType}}">{{fr.get_freezeDecisionType_display}}</span>
                                                    <div class="d-none choises freezeDecisionType">
                                                        <div><strong value="s">ش.ع</strong></div>
                                                        <div><strong value="o">و</strong></div>
                                                        <div><strong value="b">ب</strong></div>
                                                    </div>
                                                </div>
                                                <div class="text-lead text-muted fs-6 d-inline-block">
                                                    تاريخ
                                                    <span class="fr-{{fr.id}} editable" name="freezeDecisionDate"
                                                        data-toggle="datepicker">{{fr.freezeDecisionDate|date:"SHORT_DATE_FORMAT"}}</span>
                                                </div>

                                            </div>
                                            <div class="card-body">
                                                <div class="row align-items-center justify-content-between mb-2">
                                                    <div class="col-4 pt-3">
                                                        <p class="fs-5 ">مدة التجميد</p>
                                                    </div>
                                                    <div class="col-4 text-end">
                                                        <button type="button" class="btn btn-sm btn-outline-success"
                                                            onclick="editFrez(event,'{{fr.id}}', '{{demonstrator.id}}')"
                                                            id="freb-{{fr.id}}">تعديل</button>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-4">
                                                        <p class="ct"><span>سنة:</span><span
                                                                class="fr-{{fr.id}} editable"
                                                                name="freezeDurationYear">{{fr.freezeDurationYear|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-4">
                                                        <p class="ct"><span>شهر:</span><span
                                                                class="fr-{{fr.id}} editable"
                                                                name="freezeDurationMonth">{{fr.freezeDurationMonth|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                    <div class="col-4">
                                                        <p class="ct"><span>يوم:</span><span
                                                                class="fr-{{fr.id}} editable"
                                                                name="freezeDurationDay">{{fr.freezeDurationDay|default:"0"}}</span>
                                                        </p>
                                                    </div>
                                                </div>



                                            </div>

                                        </div>
                                        {% endfor %}
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-6"></div>
                                    <div class="col-6 text-center">
                                        <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal"
                                            data-bs-target="#Modalfr{{i.id}}">إضافة تجميد</button>
                                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                                            data-bs-target="#Modalex{{i.id}}">
                                            إضافة تمديد
                                        </button>
                                        <button type="button" class="btn btn-outline-success"
                                            onclick="editEfad(event,'{{i.id}}', '{{demonstrator.id}}')"
                                            id="efeb-{{i.id}}">تعديل</button>
                                        <button type="button" class="btn btn-outline-info">إضافة ملاحظات</button>
                                    </div>
                                </div>
                                <div class="modal fade" id="Modalex{{i.id}}" tabindex="-1"
                                    aria-labelledby="ModalLabel{{i.id}}" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="ModalLabel{{i.id}}">
                                                    إضافة تمديد
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body fs-6">
                                                <form method="post" action="/app/extinsert/{{i.id}}">
                                                    {% csrf_token %}

                                                    <div class="form-floating mb-3">
                                                        <input type="text" class="form-control" id="floatingInput"
                                                            placeholder="210" name="extensionDecisionNumber" />
                                                        <label for="floatingInput">رقم القرار
                                                        </label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <select name="extensionDecisionType" class="form-control"
                                                            id="floatingPassword">
                                                            <option value="">
                                                                ...
                                                            </option>
                                                            <option value="s">
                                                                ش.ع
                                                            </option>
                                                            <option value="o">
                                                                و
                                                            </option>
                                                            <option value="b">
                                                                ب
                                                            </option>
                                                        </select>
                                                        <label for="floatingPassword">نوع القرار</label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <input type="date" class="form-control" id="floatingd"
                                                            placeholder="02/15/2023" name="extensionDecisionDate" />
                                                        <label for="floatingd">تاريخ
                                                            القرار</label>
                                                    </div>
                                                    <div class="row">
                                                        <p class="col-12">مدة التمديد</p>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" id="floatinyear"
                                                                    placeholder="0" name="extensionDurationYear"
                                                                    value="0" />
                                                                <label for="floatinyear">سنة</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control"
                                                                    id="floatinmonth" placeholder="0"
                                                                    name="extensionDurationMonth" value="0" />
                                                                <label for="floatinmonth">شهر</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" id="floatinday"
                                                                    placeholder="0" name="extensionDurationDay"
                                                                    value="0" />
                                                                <label for="floatinday">يوم</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <input type="submit" value="إضافة"
                                                        class="btn btn-outline-primary" />
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal fade" id="Modalfr{{i.id}}" tabindex="-1"
                                    aria-labelledby="ModalLabel{{i.id}}" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h1 class="modal-title fs-5" id="ModalLabel{{i.id}}">
                                                    إضافة تجميد
                                                </h1>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body fs-6">
                                                <form method="post" action="/app/freinsert/{{i.id}}">
                                                    {% csrf_token %}

                                                    <div class="form-floating mb-3">
                                                        <input type="text" class="form-control" id="floatingInput"
                                                            placeholder="210" name="freezeDecisionNumber" />
                                                        <label for="floatingInput">رقم القرار
                                                        </label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <select name="freezeDecisionType" class="form-control"
                                                            id="floatingPassword">
                                                            <option value="">
                                                                ...
                                                            </option>
                                                            <option value="s">
                                                                ش.ع
                                                            </option>
                                                            <option value="o">
                                                                و
                                                            </option>
                                                            <option value="b">
                                                                ب
                                                            </option>
                                                        </select>
                                                        <label for="floatingPassword">نوع القرار</label>
                                                    </div>
                                                    <div class="form-floating mb-3">
                                                        <input type="date" class="form-control" id="floatingd"
                                                            placeholder="02/15/2023" name="freezeDecisionDate" />
                                                        <label for="floatingd">تاريخ
                                                            القرار</label>
                                                    </div>
                                                    <div class="row">
                                                        <p class="col-12">مدة التجميد</p>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" id="floatinyear"
                                                                    placeholder="0" name="freezeDurationYear"
                                                                    value="0" />
                                                                <label for="floatinyear">سنة</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control"
                                                                    id="floatinmonth" placeholder="0"
                                                                    name="freezeDurationMonth" value="0" />
                                                                <label for="floatinmonth">شهر</label>
                                                            </div>
                                                        </div>
                                                        <div class="col-4">
                                                            <div class="form-floating mb-3">
                                                                <input type="text" class="form-control" id="floatinday"
                                                                    placeholder="0" name="freezeDurationDay"
                                                                    value="0" />
                                                                <label for="floatinday">يوم</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <input type="submit" value="إضافة"
                                                        class="btn btn-outline-primary" />
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    {% endfor %} {% if not demonstrator.dispatch.all%} لا يوجد
                    إيفاد بعد {% endif %}
                </div>
            </div>
            <div class="row justify-content-center">
                <a href="/app/dispatch/{{demonstrator.id}}" class="btn btn-outline-primary col-4 mb-5 mt-3">إضافة إيفاد
                    جديد</a>
            </div>
        </div>
    </div>


</section>
<script src="{% static 'js/date-picker.min.js' %}"></script>
<script src="{% static 'js/validator.min.js' %}"></script>

<script>

    function createElementFromHTML(htmlString) {
        var div = document.createElement('div');
        div.innerHTML = htmlString.trim();

        // Change this to div.childNodes to support multiple top-level nodes.
        return div.firstChild;
    }

    function edit(object, id, did, type) {
        links = {
            "efad": `/app/updateDispatch/${id}/${did}/`,
            "ex": `/app/updateExtension/${id}/${did}/`,
            "fr": `/app/updateFreeze/${id}/${did}/`
        }
        $.post(links[type], object, function (data) {
            console.log(data);

        })
    }


    let editMode = false, efadId = "", btnId = "", originals = {}, frezId = "", exId = ""
    let csrf = createElementFromHTML(`{% csrf_token %}`)

    $(document).keydown(function (e) {

        if (e.keyCode === 27) {
            reset()
        }
    })
    function reset() {
        if (efadId) {
            resetEfad()

        }
        if (frezId) {
            resetFrez()
        }
        if (exId) {
            resetEx()
        }
    }

    function resetChoise() {
        let ch = Array.prototype.slice.call(document.getElementsByClassName("choises"), 0)
        for (let i = 0; i < ch.length; i++) {
            !ch[i].classList.add("d-none")

        }
    }

    function resetEx() {
        if (editMode && exId) {
            resetChoise()
            btn = document.getElementById(btnId)
            btn.innerHTML = 'تعديل'

            let items1 = Array.prototype.slice.call(document.getElementsByClassName(exId), 0)
            $(`.${exId}[data-toggle="datepicker"]`).datepicker('destroy')
            for (let i = 0; i < items1.length; i++) {
                items1[i].innerHTML = originals[items1[i].getAttribute('name')]
                items1[i].className = `editable ${exId}`
                items1[i].setAttribute("contenteditable", "false")

            }
            editMode = false; exId = ""; btnId = ""; originals = {}
        }
    }

    function editEx(e, id, did) {
        if (editMode && exId !== `ex-${id}`) {
            reset()
        }
        editMode = true
        exId = `ex-${id}`
        btnId = `exeb-${id}`
        let items1 = Array.prototype.slice.call(document.getElementsByClassName(exId), 0)

        if (e.target.innerHTML === 'تعديل') {
            e.target.innerHTML = 'حفظ'
            $(`.${exId}[data-toggle="datepicker"]`).datepicker({
                autoHide: true,
            });
            for (let i = 0; i < items1.length; i++) {
                originals[items1[i].getAttribute('name')] = items1[i].innerHTML
                items1[i].setAttribute("contenteditable", "true")
                if (items1[i].classList.contains("mul")) {
                    items1[i].className = `editable border border-dark p-2 ex-${id} mul activee`
                    $(`.activee`).on({
                        focusin: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).removeClass("d-none")
                            $(this).addClass("changeable")
                        },
                        blur: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).addClass("d-none")
                            $(this).removeClass("changeable")


                        },
                    }
                    )

                    $(`.activee + .${items1[i].getAttribute('name')} > div`).mousedown(function () {
                        $(`.changeable`).text($("> strong", this).text()).attr("value", $("> strong", this).attr("value"))


                    })
                } else {
                    items1[i].className = `editable border border-dark p-2 ex-${id}`
                }

            }

        } else if (e.target.innerHTML === 'حفظ') {
            const schema = {

                extensionDecisionDate: (str) => {
                    return validator.isDate(str, { format: "mm/dd/yyyy" })
                },
                extensionDecisionNumber: (str) => {
                    return !validator.isEmpty(str) && validator.isNumeric(str)
                },
                extensionDecisionType: (str) => {
                    return validator.equals(str, "s") || validator.equals(str, "o") || validator.equals(str, "b")
                },
                extensionDurationYear: (str) => true,
                extensionDurationMonth: (str) => true,
                extensionDurationDay: (str) => true,

            }
            const errors = {

                extensionDecisionDate: "تأكد من حقل تاريخ القرار",
                extensionDecisionNumber: "تأكد من حقل رقم القرار",
                extensionDecisionType: "تأكد من حقل نوع القرار",

            }

            let df = true;



            let values = {}
            for (let i = 0; i < items1.length; i++) {
                values[items1[i].getAttribute('name')] = items1[i].innerHTML
                if (items1[i].hasAttribute('value')) {
                    values[items1[i].getAttribute('name')] = items1[i].getAttribute('value')
                }
                if (!schema[items1[i].getAttribute('name')](values[items1[i].getAttribute('name')])) {
                    df = false;
                    window.alert(errors[items1[i].getAttribute('name')])
                    break;
                }
            }
            if (df) {

                for (let i = 0; i < items1.length; i++) {
                    if (items1[i].classList.contains("mul")) {
                        items1[i].className = `editable ex-${id} mul`
                    } else {
                        items1[i].className = `editable ex-${id}`
                    }

                    items1[i].setAttribute("contenteditable", "false")

                }
                e.target.innerHTML = 'تعديل'
                $(`.${exId}[data-toggle="datepicker"]`).datepicker('destroy')
                editMode = false; exId = ""; btnId = ""; orignals = {}
                console.log(values);
                values["csrfmiddlewaretoken"] = csrf.value

                edit(values, id, did, "ex")
            } else {
                values = {}
            }
        }

    }









    function resetFrez() {
        if (editMode && frezId) {
            resetChoise()
            btn = document.getElementById(btnId)
            btn.innerHTML = 'تعديل'

            let items1 = Array.prototype.slice.call(document.getElementsByClassName(frezId), 0)
            $(`.${frezId}[data-toggle="datepicker"]`).datepicker('destroy')
            for (let i = 0; i < items1.length; i++) {
                items1[i].innerHTML = originals[items1[i].getAttribute('name')]
                items1[i].className = `editable ${frezId}`
                items1[i].setAttribute("contenteditable", "false")

            }
            editMode = false; frezId = ""; btnId = ""; originals = {}
        }
    }

    function editFrez(e, id, did) {
        if (editMode && frezId !== `fr-${id}`) {
            reset()
        }
        editMode = true
        frezId = `fr-${id}`
        btnId = `freb-${id}`
        let items1 = Array.prototype.slice.call(document.getElementsByClassName(frezId), 0)

        if (e.target.innerHTML === 'تعديل') {
            e.target.innerHTML = 'حفظ'
            $(`.${frezId}[data-toggle="datepicker"]`).datepicker({
                autoHide: true,
            });
            for (let i = 0; i < items1.length; i++) {
                originals[items1[i].getAttribute('name')] = items1[i].innerHTML
                items1[i].setAttribute("contenteditable", "true")
                if (items1[i].classList.contains("mul")) {
                    items1[i].className = `editable border border-dark p-2 fr-${id} mul activee`
                    $(`.activee`).on({
                        focusin: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).removeClass("d-none")
                            $(this).addClass("changeable")
                        },
                        blur: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).addClass("d-none")
                            $(this).removeClass("changeable")


                        },
                    }
                    )

                    $(`.activee + .${items1[i].getAttribute('name')} > div`).mousedown(function () {
                        $(`.changeable`).text($("> strong", this).text()).attr("value", $("> strong", this).attr("value"))


                    })
                } else {
                    items1[i].className = `editable border border-dark p-2 fr-${id}`
                }

            }

        } else if (e.target.innerHTML === 'حفظ') {
            const schema = {

                freezeDecisionDate: (str) => {
                    return validator.isDate(str, { format: "mm/dd/yyyy" })
                },
                freezeDecisionNumber: (str) => {
                    return !validator.isEmpty(str) && validator.isNumeric(str)
                },
                freezeDecisionType: (str) => {
                    return validator.equals(str, "s") || validator.equals(str, "o") || validator.equals(str, "b")
                },
                freezeDurationYear: (str) => true,
                freezeDurationMonth: (str) => true,
                freezeDurationDay: (str) => true,

            }
            const errors = {

                freezeDecisionDate: "تأكد من حقل تاريخ القرار",
                freezeDecisionNumber: "تأكد من حقل رقم القرار",
                freezeDecisionType: "تأكد من حقل نوع القرار",

            }

            let df = true;



            let values = {}
            for (let i = 0; i < items1.length; i++) {
                values[items1[i].getAttribute('name')] = items1[i].innerHTML
                if (items1[i].hasAttribute('value')) {
                    values[items1[i].getAttribute('name')] = items1[i].getAttribute('value')
                }
                if (!schema[items1[i].getAttribute('name')](values[items1[i].getAttribute('name')])) {
                    df = false;
                    window.alert(errors[items1[i].getAttribute('name')])
                    break;
                }
            }
            if (df) {

                for (let i = 0; i < items1.length; i++) {
                    if (items1[i].classList.contains("mul")) {
                        items1[i].className = `editable fr-${id} mul`
                    } else {
                        items1[i].className = `editable fr-${id}`
                    }

                    items1[i].setAttribute("contenteditable", "false")

                }
                e.target.innerHTML = 'تعديل'
                $(`.${frezId}[data-toggle="datepicker"]`).datepicker('destroy')
                editMode = false; frezId = ""; btnId = ""; orignals = {}
                console.log(values);
                values["csrfmiddlewaretoken"] = csrf.value

                edit(values, id, did, "fr")

            } else {
                values = {}
            }
        }

    }

    function resetEfad() {
        if (editMode && efadId) {
            resetChoise()
            btn = document.getElementById(btnId)
            btn.innerHTML = 'تعديل'

            let items1 = Array.prototype.slice.call(document.getElementsByClassName(efadId), 0)
            $(`.${efadId}[data-toggle="datepicker"]`).datepicker('destroy')
            for (let i = 0; i < items1.length; i++) {
                items1[i].innerHTML = originals[items1[i].getAttribute('name')]
                items1[i].className = `editable ${efadId}`
                items1[i].setAttribute("contenteditable", "false")

            }
            editMode = false; efadId = ""; btnId = ""; originals = {}
        }


    }


    function editEfad(e, id, did) {
        if (editMode && efadId !== `efad-info-${id}`) {
            reset()
        }
        editMode = true
        efadId = `efad-info-${id}`
        btnId = `efeb-${id}`
        let items1 = Array.prototype.slice.call(document.getElementsByClassName(efadId), 0)

        if (e.target.innerHTML === 'تعديل') {
            e.target.innerHTML = 'حفظ'
            $(`.${efadId}[data-toggle="datepicker"]`).datepicker({
                autoHide: true,
            });
            for (let i = 0; i < items1.length; i++) {
                originals[items1[i].getAttribute('name')] = items1[i].innerHTML
                items1[i].setAttribute("contenteditable", "true")
                if (items1[i].classList.contains("mul")) {
                    items1[i].className = `editable border border-dark p-2 efad-info-${id} mul activee`
                    $(`.activee`).on({
                        focusin: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).removeClass("d-none")
                            $(this).addClass("changeable")
                        },
                        blur: function () {
                            $(`~ .${items1[i].getAttribute('name')}`, this).addClass("d-none")
                            $(this).removeClass("changeable")


                        },
                    }
                    )

                    $(`.activee + .${items1[i].getAttribute('name')} > div`).mousedown(function () {
                        $(`.changeable`).text($("> strong", this).text()).attr("value", $("> strong", this).attr("value"))


                    })
                } else {
                    items1[i].className = `editable border border-dark p-2 efad-info-${id}`
                }

            }

        } else if (e.target.innerHTML === 'حفظ') {

            const schema = {
                alimony: (str) => {
                    return validator.equals(str, "grant") || validator.equals(str, "seat")
                },
                backDate: (str) => {
                    return validator.isDate(str, { format: "mm/dd/yyyy" })
                },
                dispatchCountry: (str) => {
                    return validator.isLength(str, { min: 1, max: 256 })
                },
                dispatchDecisionDate: (str) => {
                    return validator.isDate(str, { format: "mm/dd/yyyy" })
                },
                dispatchDecisionNumber: (str) => {
                    return !validator.isEmpty(str) && validator.isNumeric(str)
                },
                dispatchDecisionType: (str) => {
                    return validator.equals(str, "s") || validator.equals(str, "o") || validator.equals(str, "b")
                },
                dispatchType: (str) => {
                    return validator.equals(str, "inner") || validator.equals(str, "outer")
                },
                dispatchUniversity: (str) => {
                    return validator.isLength(str, { min: 1, max: 256 })
                },
                innerSupervisor: (str) => {
                    return validator.isLength(str, { min: 1, max: 256 })
                },
                lastReportDate: (str) => {
                    return true
                },
                outerSupervisor: (str) => {
                    return validator.isLength(str, { min: 1, max: 256 })
                },
            }
            const errors = {
                alimony: "تأكد من حقل النفقة",
                backDate: "تأكد من حقل تاريخ العودة",
                dispatchCountry: "تأكد من حقل بلد الإيفاد",
                dispatchDecisionDate: "تأكد من حقل تاريخ القرار",
                dispatchDecisionNumber: "تأكد من حقل رقم القرار",
                dispatchDecisionType: "تأكد من حقل نوع القرار",
                dispatchType: "تأكد من حقل نوع الإيفاد",
                dispatchUniversity: "تأكد من حقل جامعة الإيفاد",
                innerSupervisor: "تأكد من حقل المشرف الداخلي",
                outerSupervisor: "تاكد من حقل المشرف الخارجي",
            }

            let df = true;



            let values = {}
            for (let i = 0; i < items1.length; i++) {
                values[items1[i].getAttribute('name')] = items1[i].innerHTML
                if (items1[i].hasAttribute('value')) {
                    values[items1[i].getAttribute('name')] = items1[i].getAttribute('value')
                }
                if (!schema[items1[i].getAttribute('name')](values[items1[i].getAttribute('name')])) {
                    df = false;
                    window.alert(errors[items1[i].getAttribute('name')])
                    break;
                }
            }
            if (df) {

                for (let i = 0; i < items1.length; i++) {
                    if (items1[i].classList.contains("mul")) {
                        items1[i].className = `editable efad-info-${id} mul`
                    } else {
                        items1[i].className = `editable efad-info-${id}`
                    }

                    items1[i].setAttribute("contenteditable", "false")

                }
                e.target.innerHTML = 'تعديل'
                $(`.${efadId}[data-toggle="datepicker"]`).datepicker('destroy')
                editMode = false; efadId = ""; btnId = ""; orignals = {}
                console.log(values);
                values["csrfmiddlewaretoken"] = csrf.value

                edit(values, id, did, "efad")

            } else {
                values = {}
            }

        }

    }

</script>

<script>



    $(document).ready(function () {
        var nav = $('#nav');
        var line = $('<div />').addClass('line');
        line.appendTo(nav);
        console.log(line);

        var active = nav.find('.aactive');
        var pos = 0;
        var wid = 0;
        let div = $('div.first');

        if (active.length) {
            pos = active.position().left;
            wid = active.width();
            line.css({
                left: pos,
                width: wid,
            });
        }

        nav.find('ul li button').click(function (e) {
            e.preventDefault();

            if (
                !$(this).parent().hasClass('aactive') &&
                !nav.hasClass('animate')
            ) {
                nav.addClass('animate');

                var _this = $(this);

                let div2 = $(
                    `div.${_this.parent().prop('class').split(' ')[0]}`
                );
                div.fadeOut(300, function () {
                    div2.fadeIn(150);
                    console.log(_this.parent().prop('class').split(' ')[0]);
                    div = div2;
                });

                nav.find('ul li').removeClass('aactive');

                var position = _this.parent().position();
                var width = _this.parent().width();

                if (position.left >= pos) {
                    line.animate(
                        {
                            width: position.left - pos + width,
                        },
                        300,
                        function () {
                            line.animate(
                                {
                                    width: width,
                                    left: position.left,
                                },
                                150,
                                function () {
                                    nav.removeClass('animate');
                                }
                            );
                            _this.parent().addClass('aactive');
                        }
                    );
                } else {
                    line.animate(
                        {
                            left: position.left,
                            width: pos - position.left + wid,
                        },
                        300,
                        function () {
                            line.animate(
                                {
                                    width: width,
                                },
                                150,
                                function () {
                                    nav.removeClass('animate');
                                }
                            );

                            _this.parent().addClass('aactive');
                        }
                    );
                }

                pos = position.left;
                wid = width;
            }
        });
    });
</script>


{% endblock %}